include(AddModule)
include(FetchDependencies)

fetch_openssl()
fetch_spdlog()
fetch_nlohmann_json()
fetch_yaml_cpp()

add_module(
    MODULE_NAME common 
    HEADERS
        File.h
        Logger.h
        base_types/Extent.h 
        base_types/Metadata.h 
        base_types/Dictionary.h 
        base_types/Uuid.h
        buffer/BufferView.h
        buffer/ReadableBufferView.h
        buffer/WriteableBufferView.h
        models/AccessControlList.h
        models/Model.h
        models/OwnableModel.h
        models/StorageObject.h
        models/StringAdapter.h
        models/User.h 
        models/UserGroup.h
        plugins/PluginHandle.h 
        plugins/PluginLoader.h
        random/IdGenerator.h
        streams/Stream.h
        streams/StreamIO.h
        streams/StreamSource.h
        streams/StreamSink.h
        streams/StreamState.h
        streams/impls/FifoStreamSink.h 
        streams/impls/FifoStreamSource.h
        streams/impls/FileStreamSink.h 
        streams/impls/FileStreamSource.h
        streams/impls/InMemoryStreamSink.h 
        streams/impls/InMemoryStreamSource.h
        concurrency/ThreadCollection.h 
        concurrency/TimedLock.h 
        utils/StringUtils.h
        utils/FileUtils.h
        utils/XmlUtils.h
        utils/HashUtils.h
        utils/SystemUtils.h 
        utils/JsonUtils.h
        utils/ErrorUtils.h
        utils/TimeUtils.h
        utils/UuidUtils.h
        utils/YamlUtils.h
    SOURCES  
        File.cc
        Logger.cc
        base_types/Extent.cc
        base_types/Metadata.cc
        base_types/Dictionary.cc
        base_types/Uuid.cc
        buffer/ReadableBufferView.cc
        buffer/WriteableBufferView.cc
        models/AccessControlList.cc
        models/Model.cc
        models/OwnableModel.cc
        models/StorageObject.cc
        models/User.cc
        models/UserGroup.cc
        plugins/PluginHandle.cc
        plugins/PluginLoader.cc
        random/IdGenerator.cc
        streams/Stream.cc
        streams/StreamIO.cc
        streams/StreamState.cc
        streams/impls/FifoStreamSink.cc 
        streams/impls/FifoStreamSource.cc
        streams/impls/FileStreamSink.cc 
        streams/impls/FileStreamSource.cc
        streams/impls/InMemoryStreamSink.cc 
        streams/impls/InMemoryStreamSource.cc 
        concurrency/ThreadCollection.cc
        concurrency/TimedLock.cc
        utils/ErrorUtils.cc
        utils/FileUtils.cc
        utils/HashUtils.cc
        utils/JsonUtils.cc
        utils/SystemUtils.cc
        utils/StringUtils.cc
        utils/XmlUtils.cc
        utils/TimeUtils.cc
        utils/UuidUtils.cc
        utils/YamlUtils.cc
    INTERNAL_INCLUDE_DIRS 
        base_types
        buffer
        models
        plugins
        random
        streams
        streams/impls
        concurrency
        utils
    PRIVATE_DEPENDENCIES
        yaml-cpp::yaml-cpp
        nlohmann_json::nlohmann_json
        spdlog::spdlog
        OpenSSL::SSL 
        OpenSSL::Crypto
        ${CMAKE_DL_LIBS}
    WITH_FILESYSTEM
)

target_include_directories(${PROJECT_NAME}_common PUBLIC "$<BUILD_INTERFACE:${PROJECT_BINARY_DIR}>")